<!DOCTYPE>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="keywords" content="" />
<meta name="description" content="" />
<link rel="stylesheet" href="../assets/css/bootstrap.min.css">
<link rel="stylesheet" href="../assets/css/bootstrap-select.min.css">
<title>mobipromo</title>
<style type="text/css" media="screen">
	.user_list tbody tr td:not(:first-child) {
		
		-webkit-user-select: none;
	}
	.panel-title > *{
		float:left;
	}
</style>
<body>
<div class="container">
    
	<div class="panel panel-primary">
	    <div class="panel-title" style="margin-top:30px;margin-bottom:30px;padding:0 10px;border:0;">
	      <input type="text" style="width: 100px;margin-right: 20px;" class="form-control add_pro_int" placeholder="个数">
	      <input type="text" style="width:100px;margin-right:20px;" class="form-control add_pro_count" placeholder="台数">
	      <button class="btn btn-default add_pro_btn" type="button">Go!</button>
	      <a target="_blank" class="btn btn-primary" style="color:#FFF!important;float:right;margin-left:50px;">获取F码</a>
	      <button class="btn btn-default" type="button" style="float:right;">新增代理商</button>
	      <div style="clear:both;float:none;"></div>
		</div>
	  <!-- Table -->
	  <table class="table table-hover">
		  <thead>
		    <tr>
		      <th id="coupon_title">F码 (<label></label>) 个</th>
		      <th>使用时间</th>
		      <th>是否使用</th>
		      <th>是否过期</th>
		      <th>创建时间</th>
		      <th>限购数量</th>
		    </tr>
		  </thead>
		  <tbody id="proxylist">
		    <tr v-for="item in list">
		      <td>{{ item.code }}</td>
		      <td>{{ item.usedAt}}</td>
		      <td>
		      	<span class="btn" :class="item.used ? 'btn-danger' : item.locked ? 'btn-warning' : 'btn-success'">{{ item.used ? '已使用' : item.locked ? '已锁定' : '未使用' }}</span></td>
		      <td>{{ item.expiredAt }}</td>
		      <td>{{ item.createdAt.substring(0,19).replace('T', ' ') }}</td>
		      <td class="text-center">{{ item.remark }}</td>
		    </tr>
		  </tbody>
	  </table>
	</div>
		<div id="pager"></div>
        
    </div>
</div>


<script src="../assets/js/jquery.min.js"></script>
<script src='../assets/js/bootstrap.min.js'></script>
<script src='../assets/js/bootstrap-select.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src='../assets/js/util.js'></script>
<script>
/**
*	获取cookie
*/
function getCookieValue(name) { /**获取cookie的值，根据cookie的键获取值**/
	//用处理字符串的方式查找到key对应value
	var name = escape(name);
	//读cookie属性，这将返回文档的所有cookie
	var allcookies = document.cookie;
	//查找名为name的cookie的开始位置
	name += "=";
	var pos = allcookies.indexOf(name);
	//如果找到了具有该名字的cookie，那么提取并使用它的值
	if (pos != -1) { //如果pos值为-1则说明搜索"version="失败
		var start = pos + name.length; //cookie值开始的位置
		var end = allcookies.indexOf(";", start); //从cookie值开始的位置起搜索第一个";"的位置,即cookie值结尾的位置
		if (end == -1) end = allcookies.length; //如果end值为-1说明cookie列表里只有一个cookie
		var value = allcookies.substring(start, end); //提取cookie的值
		return (value); //对它解码
	} else { //搜索失败，返回空字符串
		return "";
	}
}
var ID = getCookieValue("menage");
var url = location.href;
var num=url.indexOf("?");
	var proxyId= url.substr(num+1); 
	console.log(proxyId);
var ID = getCookieValue('manage');
if(ID == '' && proxyId == '') {
	// window.location.href = './login.html'
}







/**
*	创建VUE实例
*/ 
var proxylist_model = new Vue({
	el: '#proxylist',
	data: {
		list:''
	}
});



/**
*	获取F码信息
*/
function getCoupon(curPage) {
	$.ajax({
		type: 'POST',
		async: false,
		data: {
			curPage: curPage,
			proxyId: proxyId
		},
		url: '/promo/manage/index/getCoupons',
		success: function (data) {
			console.log(data);
			proxylist_model.list = data.list;
		$('#coupon_title label').text(data.count);
		$('#pager').empty().pagination(curPage, data.total, data.count, getCoupon);
		},
	});
}

getCoupon(1);
$("a.btn-primary").attr('href','./codes.html?' + proxyId);


/**
*添加F码
*/  	
$(".add_pro_btn").on('click', function () {
	var add_pro_int = $(".add_pro_int").val();
	$.ajax({
		type: 'POST',
		async: false,
		data: {
			proxyId: proxyId,
			count: add_pro_int,
			maxBuy: $(".add_pro_count").val()
		},
		url: '/promo/manage/index/generateCode',
		success: function (data) {
			var proxylist = getCoupon(1);

		},
	});
})
</script>
</body>
</html>






































