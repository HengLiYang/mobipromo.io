<!DOCTYPE html >
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="icon" href="assets/images/title.png" type="image/png" sizes="16x16">
	<title>mobipromo</title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link rel="stylesheet" href="assets/css/login.css" />
	<link rel="stylesheet" href="assets/css/icons/icons.css" />
	<style>
	html {
		background: #F5F5F5;

	}
	body {
		background: #ffffff;
		margin: 0 100px;
		color: #333333;
	}
	.presale-container {
		padding-top: 50px;
	}
	span {
		display: inline-block;
		width: 100px;
		text-align: left;
	}
	input {
		border: 1px solid #D0D0D0;
		border-radius: 5px;
		color: #333333;
		background: #ffffff;
		box-shadow: none;
	}
	select {
		color: #333333;
		background: #ffff;
		box-shadow: none;
		border: 1px solid #D0D0D0;
	}
	#prov {
		 margin-left: 100px;
	}
	i {
		text-decoration: none;
		color: red;
	}
	</style>
</head>
<body>
	<div class="presale-container">
		<h1>订单信息</h1>
		<div>
			<span>设备名称</span><input type="text" name="device_name" class="device_name" value="星际宝盒" disabled placeholder="设备名称">
		</div>
		<!-- <div>
			<input type="text" class="warn" value="*请填写正确地址信息！" disabled="disabled"/>
		</div> -->
		<div>
			<i>*</i><span>姓名</span><input type="text" name="username" class="username" placeholder="">
		</div>
		<div>
			<i>*</i><span>电话号码</span><input type="text" name="phone_number" class="phone_number" placeholder="">
		</div>
		<div>
			<i>*</i><span>邮箱</span><input type="text" name="mailbox" class="mailbox" placeholder="">
		</div>
		<div>
			<i>*</i><span>邮编</span><input type="text" name="zip_code" class="zip_code" placeholder="">
		</div>
		<div>
			<!--省份选择-->
			<select id="prov" name="address-level1" style="width:98px;" onchange="showCity(this)">
				<option value="">*省份</option>
			</select>
			<!--城市选择-->
			<select id="city" name="address-level2" style="width:98px;" onchange="showCounty(this)">
				<option value="">*城市</option>
			</select>
			<!--县区选择-->
			<select id="country" name="address-level3" style="width:98px;">
				<option value="">*区县</option>
			</select>
		</div>
		<div>
			<i>*</i><span>详细地址</span><input type="text" name="address-detail" class="address" placeholder="">
		</div>
		<!-- <div style="position: relative;">
			<select name="buyAmount" style="width:302px;" class="buyAmount">
				<option value="1" selected>1</option>
				<option value="2">2</option>
				<option value="3">3</option>
			</select>
			<button id='jiage' style='width: 50px; height: 50px; display: block; position: absolute; left: 70%; top: 0;'></button>
		</div> -->
		<button id="submit" type="submit" style='background: rgb(92, 81, 98)'>加载中。。。</button>
	</div>
	<style>
	.pay_btn {
		overflow: hidden;
		top: 15px;
	}
	.pay_btn div {
		float: left;
		width: 136px;
		height: 50px;
		line-height: 50px;
		font-size: 16px;
		border: 1px solid #ffffff;
		border-radius: 7px;
		cursor: pointer;
	}

	.pay_btn div:nth-child(1) {
		margin-right: 23px;
	}

	.qr_code {
		width: 100%;
		height: 100%;
		overflow: hidden;
		position: absolute;
		top: -20%;
		padding-top: 350px;
		background: #ffffff;
		display: none;
	}

	.qr_code h1 {
		font-size: 30px;
		color: #666666;
	}

	.qr_code h2 {
		font-size: 18px;
		color: #666666;
	}

	.delate {
		font-size: 26px;
		color: red;
		position: relative;
		left: 20%;
		top: -34%;
		cursor: pointer;
	}

	body {
		position: relative;
	}

	.list {
		overflow: hidden;
		max-width: 100%;
		display: inline-block;
		margin-top: 20px;
		margin-bottom: 40px;
	}

	.list ul {
		list-style: none;
		float: left;
	}

	.list ul li {
		border: 1px solid #F5F5F5;
		padding: 0 10px;
		height: 50px;
		line-height: 50px;
		font-size: 16px;
	}

	.list a {
		cursor: pointer;
		color: #338CF6;
	}
	@media screen and (max-width: 768px) {
		body {
			margin: 0 auto;
		}
		.presale-container div {
			padding: 20px;
		}
		.presale-container div>input {
			margin-top: 5px;
		}
		#prov {
			margin-left: 0;
		}
		.list {
			margin-left: 40px;
		}
		.warn {
			line-height:15px;
			margin-left:100px;
		}
		.presale-container .warn:last-child {
			padding-left: 0;
		}
		button {
			margin-left: 0;
		}
	}
	</style>
	<!-- <button class="pay" style='background: none; display: none;'>
		<div class="pay_btn">
			<div class='wechat'>微信支付</div>
			<div class='alipay'>支付宝支付</div>
		</div>
	</button> -->
	<div class="dialog dialog-box" style="top:50px;left:300px;display: none;" id="upgrade_dlg">
		<h2 class="dialog-title">订单信息</h2>
		<div class="dlg-content">
			<div tit="1y" class="price ac">
				<div class="price-date">1 台</div>
				<div class="price-text">¥
					<label class="userprice">899</label>
				</div>
				<span class="icons">&#xe658;</span>
			</div>
			<div tit="2y" class="price">
				<div class="price-date">2 台</div>
				<div class="price-text">¥
					<label class="userprice">1798</label>
				</div>
				<span class="icons">&#xe658;</span>
			</div>
			<div tit="3y" class="price" alt="y3">
				<div class="price-date">3 台</div>
				<div class="price-text">¥
					<label class="userprice">2697</label>
				</div>
				<span class="icons">&#xe658;</span>
			</div>
			<div class="dlg-item">
				<!-- <div tit="wxpay" class="price-paytype ac">
					<span style="font-size:30px;color:#19c105;" class="icons">&#xe655;</span>
					<span class="icons ico">&#xe658;</span>
				</div> -->
				<div tit="alipay" class="price-paytype ac" style="padding:12px 5px 8px 5px;margin-left:12px;">
					<span style="font-size:24px;color:#00aaee;" class="icons">&#xe654;</span>
					<span class="icons ico">&#xe658;</span>
				</div>
			</div>
			<div class="dlg-item" style="text-align:right;margin-bottom:0;">
				<button id="zhifu" class="button">去支付 <label>¥ 899</label></button>
			</div>
		</div>
	</div>
	<div class="dialog dialog-box" style="top:50px;left:300px;display: none;" id="price_dlg">
		<h2 class="dialog-title">订单信息</h2>
		<div class="dlg-content">
			<div class="price ac" style="margin-right:0;">
				<div class="price-date">1 台</div>
				<div class="price-text">¥
					<label class="userprice">899</label>
				</div>
				<span class="icons">&#xe658;</span>
			</div>
			<div class="dlg-item">
				<!-- <div tit="wxpay" class="price-paytype ac">
					<span style="font-size:30px;color:#19c105;" class="icons">&#xe655;</span>
					<span class="icons ico">&#xe658;</span>
				</div> -->
				<div tit="alipay" class="price-paytype ac" style="padding:12px 5px 8px 5px;">
					<span style="font-size:24px;color:#00aaee;" class="icons">&#xe654;</span>
					<span class="icons ico">&#xe658;</span>
				</div>
			</div>
			<div class="dlg-item" style="text-align:right;margin-bottom:0;">
				<button id="zhifu2" class="button">去支付 <label>¥ 899</label></button>
			</div>
		</div>
	</div>
	<!-- <div class="dialog dialog-box" style="display: none;" id="qr_dlg">
		<h2 class="dialog-title">&nbsp;</h2>
		<div style="text-align:center;margin-top:-29px;">
			<div>微信扫码支付</div>
			<div id="payimg" style="margin:10px 0px;width:170px;height:170px;margin:15px auto;" title="weixin://wxpay/bizpayurl?pr=mu20gtg"></div>
			<div>使用微信扫描二维码完成支付</div>
		</div>
	</div> -->
	<div class='list'>
		<ul class='list_tradeNum'>
			<li>订单编号</li>
		</ul>
		<ul class='listone'>
			<li>设备名称</li>
		</ul>
		<ul class='listtwo'>
			<li>用户名</li>
		</ul>
		<ul class='list_buyAmount'>
			<li>数量</li>
		</ul>
		<ul class='list_adree'>
			<li>收件地址</li>
		</ul>
		<ul class='list_phone'>
			<li>联系电话</li>
		</ul>
		<ul class='list_price'>
			<li>总金额</li>
		</ul>
		<ul class='list_status'>
			<li>状态</li>
		</ul>
		<div style="clear:both;"></div>
	</div>
	
	<div style="margin-top: 20px;margin-bottom: 100px;margin-left: 20%;margin-right: 20%;">
		<span style="text-align: left;">温馨提示：</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">1.每人仅限订购3台CAN星际宝盒。</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">2.您预先订购CAN星际宝盒需提前支付全款；</span>
		<!-- <span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">3.CAN星际宝盒的发货时间：在您订购的时间档内（12月23号20：00）按付款的先后顺序陆续安排在1月31号前发出；</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">4.请正确填写订购人姓名、联系方式、数量、收货地址等重要信息，确保您能及时收货。填写后请尽快提交订单，订单一旦提交将不可撤消；</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">5.订单生成后，只有支付成功的订单视为本次预售下单成功；</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">6.CAN星际宝盒发货费用由CAN官方承担；</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">7.为打击黄牛，收货信息将不可变更，请仔细确认您的收货信息，付款成功后将不可更改。由于收货信息填写错误造成您不能收货的，相关损失将由您本人承担；</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">8.CAN星际宝盒官方购买渠道：CAN星际宝盒官网；</span>
		<span style="font-size: 12px; line-height: 16px; color: #6f6d6d; margin-top: 10px; width: auto; display: block; text-align: left;">9.如有任何疑问联系微信客服，服务时间 09:00-21:00。</span> -->
	</div>
	<script src="assets/js/jquery.min.js"></script>
	<!-- <script src="assets/js/common.js"></script> -->
	<!--背景图片自动更换-->
	<script src="assets/js/supersized.3.2.7.min.js"></script>
	<!-- // <script src="assets/js/supersized-init.js"></script> -->
	<script src="assets/js/qrcode.js"></script>
	<script src="assets/js/address.js"></script>
	<!--表单验证-->
	<!-- <script src="assets/js/jquery.validate.min.js?var1.14.0"></script> -->
	<script>
	function getCookieValue(name) { /**获取cookie的值，根据cookie的键获取值**/
		//用处理字符串的方式查找到key对应value
		var name = escape(name);
		//读cookie属性，这将返回文档的所有cookie
		var allcookies = document.cookie;
		//查找名为name的cookie的开始位置
		name += "=";
		var pos = allcookies.indexOf(name);
		//如果找到了具有该名字的cookie，那么提取并使用它的值
		if (pos != -1) { //如果pos值为-1则说明搜索"version="失败
			var start = pos + name.length; //cookie值开始的位置
			var end = allcookies.indexOf(";", start); //从cookie值开始的位置起搜索第一个";"的位置,即cookie值结尾的位置
			if (end == -1) end = allcookies.length; //如果end值为-1说明cookie列表里只有一个cookie
			var value = allcookies.substring(start, end); //提取cookie的值
			return (value); //对它解码
		} else { //搜索失败，返回空字符串
			return "";
		}
	}
	var x = getCookieValue('Authorization');
	function btnPress(){
		$('.warn').remove();
		var boxName = $("input[name='device_name']").val().trim(),
			userName = $("input[name='username']").val().trim(),
			userTel = $("input[name='phone_number']").val().trim(),
			userEmail = $("input[name='mailbox']").val().trim(),
			userZipCode = $("input[name='zip_code']").val().trim(),
			addressProv = $('[name=address-level1]').val().trim(),
			addressCity = $('[name=address-level2]').val().trim(),
			addressCounty = $('[name=address-level3]').val().trim(),
			addressDetail = $("input[name='address-detail']").val().trim();
			// buyAmount = $("[name='buyAmount']").val().trim() * 1;
		var phone_number_reg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/,
			email_reg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
		var errorContent = $('<input>', {'class': 'warn'}),
			errorWarp = $('<div/>').append(errorContent);

		// var icoStartDate = new Date('2017/12/22 15:57:50');
		var currentdate = new Date();
	
		if (!boxName) {
			errorWarp.appendTo($("input[name='device_name']").parent());
			errorContent.val('设备名称不能为空');
			return;
		} else if (!userName) {
			errorWarp.appendTo($("input[name='username']").parent());
			errorContent.val('姓名不能为空');
			return;
		} else if (userName.length < 2 || userName.length > 20) {
			errorWarp.appendTo($("input[name='username']").parent());
			errorContent.val('姓名长度不合适');
			return;
		} else if (!userTel) {
			errorWarp.appendTo($("input[name='phone_number']").parent());
			errorContent.val('电话不能为空');
			return;
		} else if (!phone_number_reg.test(userTel)) {
			console.log('phone_number error');
			errorWarp.appendTo($("input[name='phone_number']").parent());
			errorContent.val('不是合法的手机号码');
			return;
		} else if (!userEmail) {
			errorWarp.appendTo($("input[name='mailbox']").parent());
			errorContent.val('邮箱不能为空');
			return;
		} else if (!email_reg.test(userEmail)) {
			console.log('email error');
			errorWarp.appendTo($("input[name='mailbox']").parent());
			errorContent.val('不是合法的邮箱');
			return;
		} else if (!userZipCode) {
			errorWarp.appendTo($("input[name='zip_code']").parent());
			errorContent.val('邮编不能为空');
			return;
		} else if (!addressProv || !addressCity || !addressCounty) {
			errorWarp.appendTo($("[name='address-level1']").parent());
			errorContent.val('请选择省市');
			return;
		} else if (!addressDetail) {
			
			errorWarp.appendTo($("[name='address-detail']").parent());
			errorContent.val('请输入详细地址');
			return;
		}
		var address = [
			provice[addressProv].name,
			provice[addressProv]["city"][addressCity].name,
			provice[addressProv]["city"][addressCity].districtAndCounty[addressCounty],
			addressDetail
		].join(' ');
		jsonData = {
			boxName: $("input[name='device_name']").val(),
			userName: $("input[name='username']").val(),
			userTel: $("input[name='phone_number']").val(),
			userEmail: $("input[name='mailbox']").val(),
			userZipCode: $("input[name='zip_code']").val(),
			receivingAddress: address
			// buyAmount: buyAmount,
			// totalRmb: 800 * buyAmount
		}
		$('#upgrade_dlg').dialog();
		$('#upgrade_dlg').find('.price').off('click').on('click', function(){
		$(this).addClass('ac').siblings('.price').removeClass('ac');
			$('#zhifu label').text('¥ ' + $(this).find('.userprice').text());
		});
		$('#upgrade_dlg').find('.price-paytype').off('click').on('click', function(){
			$(this).addClass('ac').siblings('.price-paytype').removeClass('ac');
		});
		$('#zhifu').off('click').on('click', function(){
			jsonData.buyAmount = $('.price.ac').index() + 1;
			jsonData.totalRmb = jsonData.buyAmount * 899;
			jsonData.paymentType = $('.price-paytype.ac').attr('tit');
			$.ajax({
				headers: {
					Accept: "application/json; charset=utf-8",
					Authorization: 'Bearer' + ' ' + x
				},
				url: '/promo/authed/account/post/sell/msg',
				data: JSON.stringify(jsonData),
				type: 'POST',
				contentType: "application/json; charset=utf-8",
				success: function(data) {
					console.log(data);
					if(data.isSuccess){
						location.href = data.httpurl;
					}else{
						//购买失败
						getList();
					}
				},
				error: function(data) {
					console.log(data)

				}
			});
		});
	};
	function getList() {
		$.ajax({
			headers: {
				Accept: "application/json; charset=utf-8",
				Authorization: 'Bearer' + ' ' + x
			},
			type: 'GET',
			contentType: "application/json; charset=utf-8",
			url: '/promo/authed/account/get/selllist',
			success: function(result) {
				console.log(result)
				var data = result.data;
				var listTradeNum = '';
				var listone = '';
				var listtwo = '';
				var list_buyAmount = '';
				var list_adree = '';
				var list_phone = '';
				var list_price = '';
				var list_status = '';
				if(data.length > 0) {
					$("#submit").text('不能重复购买！');
					$("#submit").css({
						'background': '#5C5162'
					});
					$('#submit').off('click');
				}
				for (var i = 0; i < data.length; i++) {
					listTradeNum += '<li>' + data[i].tradeNumber + '</li>';
					listone += '<li>' + data[i].boxName + '</li>';
					listtwo += '<li>' + data[i].userName + '</li>';
					list_buyAmount += '<li>' + data[i].buyAmount + '</li>';
					list_adree += '<li>' + data[i].receivingAddress + '</li>';
					list_phone += '<li>' + data[i].userTel + '</li>';
					list_price += '<li>' + data[i].totalRmb + '</li>';
					list_status += '<li>' + (data[i].status == 'ok' ? '已付款' : '<a href="javascript:">未确认</a>') + '</li>';
				}
				$(".list_tradeNum").html('<li>订单编号</li>' + listTradeNum);
				$(".listone").html('<li>设备名称</li>' + listone);
				$(".listtwo").html('<li>用户名</li>' + listtwo);
				$('.list_buyAmount').html('<li>数量</li>' + list_buyAmount);
				$('.list_adree').html('<li>收件地址</li>' + list_adree);
				$(".list_phone").html('<li>联系电话</li>' + list_phone);
				$(".list_price").html('<li>总金额</li>' + list_price);
				$(".list_status").html('<li>状态</li>' + list_status).find('a').off('click').on('click', function() {
					var index = $(this).parent().index() - 1;
					$('#price_dlg').dialog();
					$('#price_dlg').find('.price-paytype').off('click').on('click', function(){
						$(this).addClass('ac').siblings('.price-paytype').removeClass('ac');
					});
					$('#price_dlg').find('.price-date').text(data[index].buyAmount + ' 台');
					$('#price_dlg').find('.userprice').text(data[index].totalRmb);
					$('#zhifu2').off('click').on('click', function(){
						//完成未支付
						$.ajax({
							headers: {
								Accept: "application/json; charset=utf-8",
								Authorization: 'Bearer' + ' ' + x
							},
							url: '/promo/alipay/order/payagain',
							data: JSON.stringify({tradeNumber:data[index].tradeNumber}),
							type: 'POST',
							contentType: "application/json; charset=utf-8",
							success: function(data) {
								console.log(data);
								if(data.isSuccess){
									location.href = data.httpurl;
								}else{
									//购买失败
									globalTopTip("订单不存在", "top_error", 2000, $("#price_dlg"), !0);
								}
							},
							error: function(data) {
								globalTopTip("订单不存在", "top_error", 2000, $("#price_dlg"), !0);
							}
						});

					}).find('label').text('¥ ' + data[index].totalRmb);
				});
			},
			error: function(data) {
				console.log(data)
				// if(data.isSuccess){

				// }else {

				location.href = '/indexlogin.html';
				// }
			}
		});
	}
	getList();
    // 未开始
    var startTime = new Date('2017/12/23 20:00:00');
	var today = new Date();
	var toICO = Math.trunc((startTime.getTime()-today.getTime())/1000);
	// console.log(toICO)
	if(toICO>=0) {
		$("#submit").text('抢购尚未开始');
		$("#submit").css({
			'background': '#5C5162'
		});
		$("#submit").off('click');
	}else {
		$("#submit").text('确认信息');
		$("#submit").css({
			'background': '#458DEF'
		});
		$("#submit").on('click', function (){
			btnPress();
		});
		getList();
	}
	// $("#submit").text('确认信息');
	// 	$("#submit").css({
	// 		'background': '#458DEF'
	// 	});
	// 	$("#submit").on('click', function (){
	// 		btnPress();
	// 	});
	// 	getList();
    function countDown(){
        // var startTime = new Date("2017/12/23,01:18:30");//开始时间
        var curTime = new Date();//当前时间
        var leftTime = parseInt((startTime.getTime() - curTime.getTime())/1000);//获得时间差
        //小时、分、秒需要取模运算
        var d = parseInt(leftTime/(60*60*24));
        var h = parseInt(leftTime/(60*60)%24);
        var m = parseInt(leftTime/60%60);
        var s = parseInt(leftTime%60);
        var ms = parseInt(((startTime.getTime() - curTime.getTime())/100)%10);
        if( d > 0 || h>0 || m  >10) {
         clearInterval(set);
         return;
        }
        m = (m + '').length == 1 ? ('0' + m) : m;
        s = (s + '').length == 1 ? ('0' + s) : s;
        ms = (ms + '').length == 1 ? ('0' + ms) : ms;
        var txt = "抢购即将开始："+m+":"+s+":"+ms;
        $("#submit").text(txt);
        if(leftTime<0){ 
        	$("#submit").text("确认信息").css({
				'background': '#458DEF'
			});
        	$("#submit").off('click').on('click', btnPress);
        	clearInterval(set);}
    };
	var set = setInterval(countDown,100);
	
    // 结束
	var endTime = new Date('2017/12/23 20:08:00');//-10-05 12:00:00');
    var t = setInterval(function () {
    	var today = new Date();
    	var toICO = Math.trunc((endTime.getTime()-today.getTime())/1000);
    	// console.log(toICO)
    	if(toICO<=0) {
    		$("#submit").text('已经结束');
    		$("#submit").css({
    			'background': '#5C5162'
    		});
    		$("#submit").off('click');
    		clearInterval(t);
    	}
    }, 1000);
	// $("#submit").text('已经结束');
    // $("#submit").css({
    // 	'background': '#5C5162'
    // });
    // $("#submit").off('click');
	$("[name='buyAmount']").on('change', function() {
		$("#jiage")[0].innerHTML = 899 * $(this).val();
	}).trigger('change');

	var jsonDate = {};
	// $("#submit").on('click', function () {
	// 	btnPress();
	// });

	var addrShow = $('#addr-show');
	var prov = $('#prov');
	var city = $('#city');
	var country = $('#country');

	/*用于保存当前所选的省市区*/
	var current = {
		prov: '',
		city: '',
		country: ''
	};

	/*自动加载省份列表*/
	(function showProv() {
		var len = provice.length;
		for (var i = 0; i < len; i++) {
			var provOpt = document.createElement('option');
			provOpt.innerText = provice[i]['name'];
			provOpt.value = i;
			prov.append(provOpt);
		}
	})();

	/*根据所选的省份来显示城市列表*/
	function showCity(obj) {
		var val = obj.options[obj.selectedIndex].value;
		if (val != current.prov) {
			current.prov = val;
			addrShow.val('');
		}
		//console.log(val);
		if (val != null) {
			city[0].length = 1;
			country[0].length = 1;
			var cityLen = provice[val]["city"].length;
			for (var j = 0; j < cityLen; j++) {
				var cityOpt = document.createElement('option');
				cityOpt.innerText = provice[val]["city"][j].name;
				cityOpt.value = j;
				city.append(cityOpt);
			}
		}
	}

	/*根据所选的城市来显示县区列表*/
	function showCounty(obj) {
		var val = obj.options[obj.selectedIndex].value;
		current.city = val;
		if (val != null) {
			country[0].length = 1; //清空之前的内容只留第一个默认选项
			var countryLen = provice[current.prov]["city"][val].districtAndCounty.length;
			if (countryLen == 0) {
				addrShow.val(provice[current.prov].name + '-' + provice[current.prov]["city"][current.city].name);
				return;
			}
			for (var n = 0; n < countryLen; n++) {
				var countyOpt = document.createElement('option');
				countyOpt.innerText = provice[current.prov]["city"][val].districtAndCounty[n];
				countyOpt.value = n;
				country.append(countyOpt);
			}
		}
	}

	$.fn.dialog = function(option) {
		var dlgWin = $(this);
		if ("string" == typeof option)
			"close" == option && (dlgWin.find(".dialog-close").trigger("click"),
			null != $("#window-mask") && $("#window-mask").hide());
		else {
			var defaults = {
				fixed: !0,
				closable: !0,
				mask: !0
			};
			option = $.extend(defaults, option),
			option || (option = {});
			var title = "";
			option.title ? title = option.title : dlgWin.attr("title") && (title = dlgWin.attr("title"),
			dlgWin.attr("title", "")),
			dlgWin.addClass("dialog-box").show();
			var closeBtn = $("<div class='dialog-close'>&times;</div>").appendTo(dlgWin);
			closeBtn.bind("click", function() {
				if (!option.onClose || 0 != option.onClose()) {
					// $.mask("close"),
					dlgWin.hide(),
					dlgWin.removeClass("dialog-box").find(".dialog-close").remove();
					var title = dlgWin.find(".dialog-title");
					dlgWin.attr("title", title.text()),
					title.remove(),
					$(window).unbind("resize.dialog")
				}
			}),
			dlgWin.find(".close").on("click", function() {
				closeBtn.click()
			}),
			option.closable && closeBtn.show(),
			"" != title && dlgWin.prepend("<h2 class='dialog-title'>" + title + "</h2>"),
			// option.mask && $.mask(),
			$(window).bind("resize.dialog", function() {
				var outerWidth = dlgWin.outerWidth()
				  , outerHeight = dlgWin.outerHeight()
				  , top = 0;
				option.fixed ? (dlgWin.css("position", "fixed"),
				top = ($(window).height() - outerHeight) / 2 + "px") : (dlgWin.css("position", "absolute"),
				top = ($(window).height() - outerHeight) / 2 + $(document).scrollTop() + "px");
				var left = ($(window).width() - outerWidth) / 2 + "px";
				dlgWin.css({
					top: top,
					left: left
				})
			}),
			$(window).trigger("resize.dialog"),
			dlgWin.find(".dialog-title").draggable({
				target: dlgWin
			});
		}
		return dlgWin
	}

	$.fn.draggable = function(a) {
		var b = {
			target: "default",
			clone: !1,
			undrag: "",
			scroll: !0,
			start: function() {},
			drag: function() {},
			end: function() {}
		}
		  , c = $.extend(b, a);
		return $(this).off("mousedown.drag").on("mousedown.drag", function(a) {
			$(document).on("selectstart.drag dragstart", function() {
				return !1
			});
			var b = $(this)
			  , d = "string" == typeof c.target && "default" == c.target ? b : c.target
			  , e = a.pageX
			  , f = a.pageY
			  , g = d.offset().left
			  , h = d.offset().top;
			c.clone && (d = b.clone().removeAttr("id").css("position", "absolute").offset({
				left: g,
				top: h
			}),
			"function" == typeof c.clone && (c.clone.call(d, a),
			g = 1 * d.css("left").replace("px", ""),
			h = 1 * d.css("top").replace("px", "")),
			c.opacity && d.css("opacity", c.opacity)),
			$(document).on("mousemove.drag", function(a) {
				b.hasClass("ondrag") || (b.addClass("ondrag"),
				c.clone && d.appendTo(b.parent()),
				c.start.call(b[0], a));
				var i = a.pageX - e + g
				  , j = a.pageY - f + h;
				if (c.bounding) {
					var k = c.bounding.offset().left
					  , l = c.bounding.offset().top;
					i > k && j > l && i < k + c.bounding.outerWidth() - d.outerWidth() && j < l + c.bounding.outerHeight() - d.outerHeight() && d.offset({
						left: i,
						top: j
					})
				} else
					d.offset({
						left: i,
						top: j
					});
				c.drag.call(b[0], a)
			}),
			$(document).on("mouseup.drag", function(a) {
				c.end.call(b[0], a),
				c.clone && d.remove(),
				$(document).off("selectstart.drag dragstart"),
				$(document).off("mousemove.drag"),
				$(document).off("mouseup.drag"),
				$(".drop-hover").length || b.removeClass("ondrag")
			}),
			$(this).on("mouseup.drag", function(a) {
				$(document).trigger("mouseup.drag"),
				$(this).off("mouseup.drag")
			})
		}),
		c.undrag && $(this).find(c.undrag).off("mousemove.drag").on("mousemove.drag", function(a) {
			a.stopPropagation()
		}).on("dragstart", function() {
			return !1
		}),
		this
	}

	globalTopTip = function(a, b, c, d, e) {
	    if ("undefined" != typeof a) {
	        null == c && (c = 5e3),
	        null == b && (b = "top_success");
	        var f = $("#global_top_dialog");
	        f.length > 0 && f.remove(),
	        f = $('<div id="global_top_dialog" class="global_top_dialog"><div class="left_arrow"></div>' + a + '<div class="right_arrow"></div></div>').appendTo("body"),
	        f.addClass(b),
	        e && (f.find(".left_arrow").remove(),
	        f.find(".right_arrow").remove(),
	        f.addClass("noarrow"));
	        var g = f.outerWidth();
	        d ? f.css("top", $(d).offset().top + "px") : 0 == $("#header").length && f.css("top", "0px"),
	        f.css({
	            "margin-left": -(.5 * g) + "px"
	        }).show(),
	        setTimeout(function() {
	            f.addClass("show"),
	            setTimeout(function() {
	                f.removeClass("show"),
	                setTimeout(function() {
	                    f.fadeOut("slow").remove()
	                }, 250)
	            }, c)
	        }, 50)
	    }
	}
	</script>
</body>

</html>